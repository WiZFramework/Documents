<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>言語を作ろうプロジェクト（2019年）</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h3>０４．インタプリタの作成</h3>
</div>
<!-- コンテンツ　-->
<div id="contents">
<h3>０４－０２．ソースコード</h3>
　完全ではないですが、出来たところまで公開します。<br />
　分岐、ループ、変数など、おおむね最低限必要な機能は実装しました。<br />
　大きなところで残っているのは、配列とクラス（構造体）などでしょうか？<br />
　まず<b>oreProject</b>の<b>ヘッダーファイル</b>を<b>右クリック</b>し<b>追加－新しい項目</b>で
<div class="box1">
<pre>
expression.h
interpreter.h
objBase.h
statement.h
util.h
value.h
</pre>
</div>
　を追加します。<br />
　続いて、<b>oreProject</b>の<b>ソースファイル</b>を<b>右クリック</b>し<b>追加－新しい項目</b>で
<div class="box1">
<pre>
expression.cpp
interpreter.cpp
objBase.cpp
statement.cpp
value.cpp
</pre>
</div>
　を追加します。<br />
　最後に
<div class="box1">
<pre>
proc.cpp
</pre>
</div>
　を「<span class="red">削除</span>」します
　結果として、以下の様なファイル構成になります。
<h4>ヘッダファイル</h4>
<div class="box1">
<pre>
expression.h
interpreter.h
objBase.h
oreProject.tab.h　<span class="red">※このファイルはBisonが更新するので触る必要はない</span>
proc.h
statement.h
util.h
value.h
</pre>
</div>
<h4>ソースファイル</h4>
<div class="box1">
<pre>
expression.cpp
interpreter.cpp
main.cpp
objBase.cpp
oreProject.flex.cpp　<span class="red">※このファイルはFlexが更新するので触る必要はない</span>
oreProject.tab.cpp　<span class="red">※このファイルはBisonが更新するので触る必要はない</span>
statement.cpp
value.cpp
</pre>
</div>
<h4>スクリプトファイル</h4>
<div class="box1">
<pre>
index.ore
</pre>
</div>
　そのうえで、各ファイルを以下のように記述します。各リンクをクリックしてください。
<h4>expression.hの記述</h4>
　<a href="04_02expression_h.html"><b>expression.h</b></a>
<h4>interpreter.hの記述</h4>
　<a href="04_02interpreter_h.html"><b>interpreter.h</b></a>
<h4>objBase.hの記述</h4>
　<a href="04_02objBase_h.html"><b>objBase.h</b></a>
<h4>proc.hの記述</h4>
　<a href="04_02proc_h.html"><b>proc.h</b></a>
<h4>statement.hの記述</h4>
　<a href="04_02statement_h.html"><b>statement.h</b></a>
<h4>util.hの記述</h4>
　<a href="04_02util_h.html"><b>util.h</b></a>
<h4>value.hの記述</h4>
　<a href="04_02value_h.html"><b>value.h</b></a>
<h4>expression.cppの記述</h4>
　<a href="04_02expression_cpp.html"><b>expression.cpp</b></a>
<h4>interpreter.cppの記述</h4>
　<a href="04_02interpreter_cpp.html"><b>interpreter.cpp</b></a>
<h4>main.cppの記述</h4>
　<a href="04_02main_cpp.html"><b>main.cpp</b></a>
<h4>objBase.cppの記述</h4>
　<a href="04_02objBase_cpp.html"><b>objBase.cpp</b></a>
<h4>statement.cppの記述</h4>
　<a href="04_02statement_cpp.html"><b>statement.cpp</b></a>
<h4>value.cppの記述</h4>
　<a href="04_02value_cpp.html"><b>value.cpp</b></a>
<h4>oreProject.lの書き換え</h4>
　続いて、FlexBison側の<b>oreProject.l</b>です。<br />
　<a href="04_02oreProject_l.html" ><b>oreProject.l</b></a>
<h4>oreProject.yの書き換え</h4>
　続いて、FlexBison側の<b>oreProject.y</b>です。<br />
　<a href="04_02oreProject_y.html" ><b>oreProject.y</b></a>
<h4>index.oreの書き換え</h4>
　最後に<b>index.ore</b>です。テスト用のスクリプトを記述します。
<div class="box1">
<pre>
//数字で初期化
test1 = 123;
//文字列を連結
test1 &= "abc";
//出力
pn "1: " & test1;
//それに数字を足す
test2 = test1 + 246;
//出力
pn "2: " & test2;

max = 500;
//:fromから:toまで加算する関数
fnc func1(:from,:to){
    //先頭に:が付くのはローカル変数
    :c = 0;
    whl(:from &lt;= :to){
        :c += :from;
        :from++;
        if(:c > max)
            //maxはグローバル変数を参照
            ret "オーバーフローしました。";
    }
    //出力
    pn "3: " & :c;
    ret "4: OKです。";
}
//関数呼び出し
pn func1(1,10);
</pre>
</div>
<h4>ビルドと実行</h4>
　<b>リビルド</b>して<b>デバッグなしで実行</b>します。以下の出力が得られれば成功です。
<div class="box1">
<pre>
1: 123abc
2: 369
3: 55
4: OKです。

...oreProject\Debug\oreProject.exe (プロセス 6344) は、コード 0 を伴って終了しました。
このウィンドウを閉じるには、任意のキーを押してください . . .
</pre>
</div>
　では次項から解説します。
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="04_01.html">前ページ</a></li>
<li><a href="index.html">目次</a></li>
</ul>
<!-- /フッタ　-->
</div>
<!-- /全体コンテナ　-->
</body>
</html>
