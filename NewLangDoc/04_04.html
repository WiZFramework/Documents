<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link href="css/main.css" rel="stylesheet" type="text/css">
<title>言語を作ろうプロジェクト（2018年）</title>
</head>
<body>
<!-- 全体コンテナ　-->
<div id="container">
<div id="header">
<h3>０４．インタプリタの作成</h3>
</div>
<!-- コンテンツ　-->
<div id="contents">
<h3>０４－０４．式と文</h3>
<h4>式とは何か</h4>
　皆さんは<b>式（英語で言えばExpression）</b>というと何を想像しますか？<br />
<div class="box1">
<pre>
1 + 10
</pre>
</div>
　というのは<b>式</b>です。では<b>1</b>や<b>10</b>はどうでしょうか？<br />
　プログラミング言語の世界（特にC言語）では、<b>1</b>や<b>10</b>も立派な<b>式</b>なのです。<br />
　プログラムというのは<b>テキストエディタ</b>で記述します。それを、コンパイル言語なら<b>ビルド</b>というのを行ってから<b>実行</b>します。インタプリタ言語では、そのまま、何らかの言語プログラムで解析して実行します。<br />
　つまり、書いたばかりの<b>プログラム</b>は単なる<b>テキスト</b>なのです。それを<b>演算</b>したり<b>分岐</b>したりして、初めて<b>実行できる状態</b>になります。<br />
　つまり、<b>数字の1</b>から、<b>数値の1</b>にどこかで変更しなければなりません。<br />
　その過程で<b>演算</b>が行われます。<br />
　<b>式</b>の定義として
<div class="box1">
<pre>
何らかの演算をして、その結果を返す
</pre>
</div>
　とすれば、<b>1</b>というのは
<div class="box1">
<pre>
数字の1を演算し数値の1を返す
</pre>
</div>
　という立派な<b>式</b>なのがわかります。<br />
　ここでいう<b>数字の1</b>のような記述を<b>整数を表現する手段</b>という意味で、<b>整数リテラル</b>といいます。<br />
　では<b>式</b>というのは<b>必ず結果を返すのか</b>という疑問がでます。正確に言えば、あるケースでは<b>結果を返さない</b>こともあります。<br />
　このケースは後々説明するとして、今は<b>式は値を返す</b>と考えましょう。<br />
　<b>1</b>や<b>10</b>は<b>式</b>なのはわかりました。では<b>+</b>はどうでしょうか？<br />
　残念ながらこれは<b>式</b>ではなく<b>演算子</b>です。演算子は<b>予約語</b>の一種です。<b>+</b>演算子は<b>足し算</b>を表します。<br />
　左辺と右辺の間に挟まれることによって<b>式</b>を作り出します。<b>+</b>演算子は<b>左辺と右辺を足してその結果を返す</b>という<b>式</b>を作り出します。<br />
　ですから<b>$</b>を足し算の演算子にしても、文法的にはなんら問題はありません。単なる予約語ですから。（使いやすいかどうかは別ですが）。<br />
　さて、ではもう少し複雑な以下を考えてみましょう。
<div class="box1">
<pre>
a = 3 + 5 * 4
</pre>
</div>
　<b>=</b>は代入演算子です。<b>右辺の式</b>を<b>左の変数</b>に入れます。<br />
　また<b>a</b>は識別子式です。左辺に使用することで、<b>指定の変数（値の箱）</b>を返します。右辺に使用すれば、<b>その箱の中身の値</b>を返します。<br />
　それを踏まえて上記の構文がどのように動くか考えてみましょう。
<div class="box1">
<pre>
１、5という整数リテラルを5という数値に変換し返す
２、4という整数リテラルを4という数値に変換し返す
３、*演算子によって数値同士を掛け算し、20という数値を返す
４、3という整数リテラルを3という数値に変換し返す
５、3という数値と20という数値を足し算して23という数値を返す
６、aという識別子を参照し、その変数を返す
７、その変数に23という数値を代入し、23という数値を返す
</pre>
</div>
　最終的に代入式が実行され、代入式は<b>代入された値そのものを返す</b>という仕様になっています。<br />
　つまりこれだけの内容の<b>式</b>が実行されるのがわかります。<br />
　<b>式</b>は上記の例のほかに
<div class="box1">
<pre>
boolリテラル（trかfl、あるいは,trueかfalse）
浮動小数点リテラル（5.0とか3.14とかの表現）
文字列リテラル（"abc"とか'xyz'という表現）
関数呼び出し式
...
</pre>
</div>
　などがあります。<br />
　ここで<b>bool型リテラル</b>に<b>trかfl</b>と書きました。通常は<b>trueかfalse</b>ですね。<b>oreProject</b>では実験的に<b>短いバージョンの予約語</b>も用意したいと思っています。例えば<b>while</b>も<b>wh</b>とか書けたらキーボードを打つ回数が減って便利でしょう。<br />
　また、出力する構文
<div class="box1">
<pre>
pn 2 + 4
</pre>
</div>
　も実は<b>式</b>です。他言語でも、よく<b>print文</b>などと書かれますが、内部的には<b>式</b>なんですね。<br />
　また<b>関数呼び出し</b>も<b>式</b>です。C言語では
<div class="box1">
<pre>
if(func()){
    //何かやる
}
</pre>
</div>
　みたいな記述で関数呼び出しを行います（oreProjectでも、そのように記述できるようにします）。<br />
　これは<b>関数呼び出し</b>が<b>式</b>の一種だから可能なのです。
<h4>文とは何か</h4>
　<b>式</b>が集まって<b>文（Statement）</b>になります。<b>文</b>は<b>実行の単位</b>です。<br />
　以下の
<div class="box1">
<pre>
a = 3 + 5 * 4
pn a;
</pre>
</div>
　というのは、エラーになります。<b>index.ore</b>にこれを記述して実行してみると
<div class="box1">
<pre>

文法エラーだぞい。2 行目: pn 付近をみでくんつえ。

...\oreProject\Debug\oreProject.exe (プロセス 2384) は、コード 1 を伴って終了しました。
このウィンドウを閉じるには、任意のキーを押してください . . .
</pre>
</div>
　と出ます。<b>oreProject</b>では<b>文は ; で終わる</b>ことになっています。<br />
　行単位の実行文を<b>文</b>としている言語であれば、エラーになりません。<br />
　ちなみに<b>oreProject</b>はエラーの出力に<b>東北弁（正確に言えばふぐしま弁）</b>を使用しています。<br />
　気になる人は、<b>interpreter.cpp</b>に<b>エラー出力用</b>のテーブルの記述があるので変更してください。<br />
　上記は
<div class="box1">
<pre>
a = 3 + 5 * 4<span class="red">;</span>
pn a;
</pre>
</div>
　とすると実行できます。（セミコロンが記述されています）<br />
<br />
　<b>文</b>で一番多いのは<b>式文</b>です。<b>oreProject</b>では
<div class="box1">
<pre>
expression ;
</pre>
</div>
　という形です。<b>式</b>がまとめられて、最終的に<b>expression</b>になります。それが<b> ; </b>によって<b>実行せよ</b>という意味になります。<br />
　このほかに<b>式</b>は
<div class="box1">
<pre>
If、elseif、else文（if、ei、es文）
while文（wh文）
for文（fr文）
return文（rt文）
...
</pre>
</div>
　などを記述予定です。（　）内は、短い予約語の予定です。
<h4>文の集合、文リストとブロック</h4>
　<b>文</b>が集まって<b>文リスト（StatementList）</b>になります。<br />
　<b>文リスト</b>をまとめるのが<b>ブロック文（BlockStm）</b>になります。<b>ブロック文</b>は<b> { } </b>で囲みます。<br />
　<b>ブロック文</b>は<b>文の仲間</b>なので、このブロックが入れ子構造になり、<b>ツリー</b>を形成します。
<h4>まとめ</h4>
　この項では<b>式や文</b>あるいは<b>式リストやブロック</b>など<b>oreProject</b>に限らず、一般的な考え方を含め説明しました。<br />
　次項では、ではこのような構造を<b>oreProject</b>ではどのように実装しているのか、を詳細に説明したいと思います。
</div>
<!-- /コンテンツ　-->
<hr>
<!-- フッタ　-->
<ul class="foot_navi">
<li><a href="04_03.html">前ページ</a></li>
<li><a href="index.html">目次</a></li>
</ul>
<!-- /フッタ　-->
</div>
<!-- /全体コンテナ　-->
</body>
</html>
